📋 OCR 识别能力优化说明
═══════════════════════════════════════════

🎯 优化目标
───────────
解决 OCR 只识别中文字幕，遗漏大量英文、数字文本的问题

🔧 技术方案
───────────
1. 降低检测阈值
   • det_db_thresh: 0.3 → 0.2
     含义：二值化阈值，越低检测到的文本区域越多
   
   • det_db_box_thresh: 0.6 → 0.5
     含义：边框置信度阈值，越低保留越多候选框

2. 扩大文本框范围
   • det_db_unclip_ratio: 1.5 → 1.8
     含义：检测框扩展比例，可捕获更多边缘文本

3. 降低识别过滤阈值
   • min_score: 0.5 → 0.25
     含义：识别结果置信度，保留更多低置信度但可能正确的结果

📊 效果对比
───────────
测试视频: test.mp4 (前15帧)

┌────────────────┬──────────┬────────────────────┐
│ 参数配置       │ 识别字符 │ 识别内容           │
├────────────────┼──────────┼────────────────────┤
│ 优化前 (默认)  │ 21 字符  │ 仅中文字幕         │
│ 优化后         │ 453字符  │ 中英文+数字+标识   │
│ 提升倍数       │ 21.6x    │ 全面识别           │
└────────────────┴──────────┴────────────────────┘

识别内容示例：
  ✓ 中文字幕: "当全世界都将你抛弃时"
  ✓ 英文标识: "OLD STREET", "EUSTON SQUARE"
  ✓ 混合文本: "Items trapped in the doors cause"
  ✓ 数字编号: "93", "S1093"
  ✓ 品牌标识: "#LikeABosch"

⚙️ 参数调优建议
─────────────────

如果识别效果仍不理想，可以进一步调整：

1. 更激进的检测
   修改 ocr_utils.py 中的参数：
   ```python
   det_db_thresh=0.15,        # 更低检测阈值
   det_db_box_thresh=0.4,     # 更低边框阈值
   det_db_unclip_ratio=2.0,   # 更大扩展比例
   ```

2. 更宽松的过滤
   修改 process_video.py 中的调用：
   ```python
   ocr_text = ocr_folder_to_text(ocr, str(frames_dir), min_score=0.2)
   ```

3. 使用更精确的模型
   ```bash
   make ocr VIDEO=xxx DET_MODEL=server REC_MODEL=server
   ```
   注意：server 模型更慢但更准确

⚠️ 注意事项
────────────
• 阈值过低可能产生误检（将图像噪点识别为文字）
• 建议先用默认参数测试，如不满意再调整
• 复杂背景视频建议使用 server 模型
• OCR 处理速度较慢，请耐心等待进度条完成

🔍 调试模式
───────────
如需查看被过滤的低置信度文本，修改代码：

```python
# 在 process_video.py 中
ocr_text = ocr_folder_to_text(ocr, str(frames_dir), min_score=0.25, debug=True)
```

debug=True 会显示：
  • 每张图片的识别数量
  • 被过滤的文本及其置信度
  • 有助于判断是否需要进一步降低阈值

📚 相关文件
───────────
• ocr_utils.py - OCR 核心逻辑和参数配置
• process_video.py - 调用 OCR 的主流程
• test_ocr_threshold.py - 阈值对比测试脚本
• test_ocr_fix.py - OCR 功能验证脚本

💡 最佳实践
────────────
1. 日常使用: mobile 模型 + 默认参数 (0.25)
2. 重要内容: server 模型 + 默认参数
3. 复杂场景: server 模型 + 更低阈值 (0.2)
4. 简单字幕: mobile 模型 + 略高阈值 (0.3)

═══════════════════════════════════════════
更新时间: 2025-12-11
版本: v2.1
