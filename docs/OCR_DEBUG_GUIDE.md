# ğŸ” OCR è°ƒè¯•å®Œå…¨æŒ‡å—

## ç›®å½•
- [å¿«é€Ÿè¯Šæ–­](#å¿«é€Ÿè¯Šæ–­)
- [å‚æ•°è¯¦è§£](#å‚æ•°è¯¦è§£)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [è°ƒè¯•å·¥å…·](#è°ƒè¯•å·¥å…·)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## å¿«é€Ÿè¯Šæ–­

### é—®é¢˜è¯Šæ–­æµç¨‹å›¾

```
OCR è¯†åˆ«æ•ˆæœä¸ç†æƒ³
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®Œå…¨æ²¡æœ‰è¯†åˆ«ï¼Ÿâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚  æ˜¯   â”‚ â†’ æ£€æŸ¥ API æ˜¯å¦æ­£å¸¸å·¥ä½œ
    â””â”€â”€â”€â”€â”€â”€â”€â”˜   è¿è¡Œ: python test_ocr_debug.py --check-api
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚  å¦   â”‚ â†’ è¯†åˆ«ä¸å…¨æˆ–é”™è¯¯
    â””â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥è¯†åˆ«ç±»å‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ ä¸­æ–‡æ­£å¸¸  â”‚ â†’ æ£€æµ‹å‚æ•°è¿‡ä¸¥
    â”‚ è‹±æ–‡ç¼ºå¤±  â”‚   é™ä½ det_db_thresh
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å¢å¤§ det_db_unclip_ratio
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ éƒ½æœ‰è¯†åˆ«  â”‚ â†’ ç½®ä¿¡åº¦è¿‡æ»¤å¤ªä¸¥
    â”‚ ä½†é‡å¾ˆå°‘  â”‚   é™ä½ min_score
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   è¿è¡Œ: --test-threshold
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ è¯†åˆ«é”™è¯¯  â”‚ â†’ å›¾ç‰‡è´¨é‡é—®é¢˜ æˆ–
    â”‚ ä¹±ç å¤š    â”‚   æ¨¡å‹ä¸é€‚é…
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å°è¯• server æ¨¡å‹
```

---

## å‚æ•°è¯¦è§£

### 1. æ£€æµ‹é˜¶æ®µå‚æ•°

#### `det_db_thresh` (æ£€æµ‹äºŒå€¼åŒ–é˜ˆå€¼)
- **ä½œç”¨**: æ§åˆ¶æ–‡æœ¬åŒºåŸŸæ£€æµ‹çš„æ•æ„Ÿåº¦
- **èŒƒå›´**: 0.0 ~ 1.0
- **é»˜è®¤å€¼**: 0.3
- **æ¨èå€¼**: 0.2

```python
# å€¼è¶Šå°ï¼Œæ£€æµ‹è¶Šæ•æ„Ÿï¼Œèƒ½å‘ç°æ›´å¤šæ–‡æœ¬åŒºåŸŸ
det_db_thresh=0.15  # éå¸¸æ•æ„Ÿï¼Œå¯èƒ½è¯¯æ£€
det_db_thresh=0.2   # âœ… æ¨èï¼šå¹³è¡¡
det_db_thresh=0.3   # ä¿å®ˆï¼Œå¯èƒ½æ¼æ£€
det_db_thresh=0.5   # éå¸¸ä¿å®ˆ
```

**è°ƒè¯•å»ºè®®**:
- ä¸­è‹±æ–‡æ··åˆåœºæ™¯: 0.2
- çº¯ä¸­æ–‡å­—å¹•: 0.25
- å¤æ‚èƒŒæ™¯: 0.15
- ç®€å•å¹²å‡€èƒŒæ™¯: 0.3

#### `det_db_box_thresh` (è¾¹æ¡†ç½®ä¿¡åº¦é˜ˆå€¼)
- **ä½œç”¨**: è¿‡æ»¤ä½è´¨é‡çš„æ–‡æœ¬æ¡†
- **èŒƒå›´**: 0.0 ~ 1.0
- **é»˜è®¤å€¼**: 0.6
- **æ¨èå€¼**: 0.5

```python
# å€¼è¶Šå°ï¼Œä¿ç•™çš„å€™é€‰æ¡†è¶Šå¤š
det_db_box_thresh=0.4   # ä¿ç•™æ›´å¤šå€™é€‰æ¡†
det_db_box_thresh=0.5   # âœ… æ¨è
det_db_box_thresh=0.6   # è¿‡æ»¤è¾ƒä¸¥æ ¼
```

#### `det_db_unclip_ratio` (æ–‡æœ¬æ¡†æ‰©å±•æ¯”ä¾‹)
- **ä½œç”¨**: æ£€æµ‹æ¡†å‘å¤–æ‰©å±•çš„æ¯”ä¾‹
- **èŒƒå›´**: 1.0 ~ 3.0
- **é»˜è®¤å€¼**: 1.5
- **æ¨èå€¼**: 1.8

```python
# å€¼è¶Šå¤§ï¼Œæ–‡æœ¬æ¡†è¶Šå¤§ï¼Œèƒ½æ•è·æ›´å¤šè¾¹ç¼˜å†…å®¹
det_db_unclip_ratio=1.2   # ç´§å‡‘ï¼Œå¯èƒ½è£åˆ‡è¾¹ç¼˜
det_db_unclip_ratio=1.5   # æ ‡å‡†
det_db_unclip_ratio=1.8   # âœ… æ¨èï¼šæ•è·è¾¹ç¼˜
det_db_unclip_ratio=2.2   # éå¸¸å®½æ¾ï¼Œå¯èƒ½åŒ…å«å™ªç‚¹
```

**è°ƒè¯•å»ºè®®**:
- å°å­—ä½“æ–‡æœ¬: 2.0
- æ ‡å‡†å­—ä½“: 1.8
- å¤§å­—å¹•: 1.5

### 2. è¯†åˆ«é˜¶æ®µå‚æ•°

#### `min_score` (æœ€å°ç½®ä¿¡åº¦)
- **ä½œç”¨**: è¿‡æ»¤ä½ç½®ä¿¡åº¦çš„è¯†åˆ«ç»“æœ
- **èŒƒå›´**: 0.0 ~ 1.0
- **æ¨èå€¼**: 0.25

```python
# å€¼è¶Šå°ï¼Œä¿ç•™çš„ç»“æœè¶Šå¤šï¼ˆåŒ…æ‹¬å¯èƒ½é”™è¯¯çš„ï¼‰
min_score=0.2   # éå¸¸å®½æ¾ï¼Œå¯èƒ½æœ‰è¯¯è¯†åˆ«
min_score=0.25  # âœ… æ¨èï¼šå¹³è¡¡
min_score=0.3   # ä¿å®ˆ
min_score=0.5   # éå¸¸ä¸¥æ ¼ï¼Œä¼šä¸¢å¤±å¾ˆå¤šç»“æœ
```

**ç»éªŒå€¼**:
- è‹±æ–‡+æ•°å­—: 0.25
- çº¯ä¸­æ–‡: 0.3
- å¤æ‚åœºæ™¯: 0.2
- é«˜è´¨é‡å›¾ç‰‡: 0.35

#### `rec_batch_num` (æ‰¹å¤„ç†å¤§å°)
- **ä½œç”¨**: ä¸€æ¬¡å¤„ç†å¤šå°‘ä¸ªæ–‡æœ¬æ¡†
- **èŒƒå›´**: 1 ~ 30
- **æ¨èå€¼**: 6

```python
rec_batch_num=1    # æ…¢ä½†ç¨³å®š
rec_batch_num=6    # âœ… æ¨è
rec_batch_num=12   # å¿«ä½†å å†…å­˜
```

---

## å¸¸è§é—®é¢˜

### Q1: å®Œå…¨è¯†åˆ«ä¸åˆ°æ–‡å­—

**å¯èƒ½åŸå› **:
1. PaddleOCR æ¨¡å‹æœªæ­£ç¡®åŠ è½½
2. å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ
3. å›¾ç‰‡å®Œå…¨æ²¡æœ‰æ–‡å­—å†…å®¹

**æ’æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥ API æ˜¯å¦æ­£å¸¸
python test_ocr_debug.py --check-api

# 2. æµ‹è¯•å•å¼ å›¾ç‰‡
python test_ocr_debug.py --image output/test_xxx/frames/frame_00001.png

# 3. æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯
python test_ocr_debug.py --image xxx.png --debug
```

### Q2: åªè¯†åˆ«ä¸­æ–‡ï¼Œè‹±æ–‡æ•°å­—ç¼ºå¤±

**åŸå› **: æ£€æµ‹é˜ˆå€¼è¿‡é«˜ï¼Œæ— æ³•æ£€æµ‹åˆ°å°å­—ä½“æˆ–ä½å¯¹æ¯”åº¦çš„è‹±æ–‡

**è§£å†³æ–¹æ¡ˆ**:
```python
# ä¿®æ”¹ ocr_utils.py ä¸­çš„ init_ocr å‡½æ•°
det_db_thresh=0.15,           # é™ä½åˆ° 0.15
det_db_box_thresh=0.45,       # é™ä½åˆ° 0.45
det_db_unclip_ratio=2.0,      # å¢å¤§åˆ° 2.0
```

### Q3: è¯†åˆ«åˆ°å¾ˆå¤šä¹±ç 

**åŸå› **: æ£€æµ‹é˜ˆå€¼è¿‡ä½ï¼Œè¯¯å°†å™ªç‚¹è¯†åˆ«ä¸ºæ–‡å­—

**è§£å†³æ–¹æ¡ˆ**:
```python
# æé«˜æ£€æµ‹é˜ˆå€¼
det_db_thresh=0.25,           # æé«˜åˆ° 0.25
det_db_box_thresh=0.55,       # æé«˜åˆ° 0.55
min_score=0.35,               # æé«˜è¯†åˆ«è¿‡æ»¤
```

### Q4: å¤„ç†é€Ÿåº¦å¤ªæ…¢

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. ä½¿ç”¨ mobile æ¨¡å‹ï¼ˆé»˜è®¤ï¼‰
2. å¢å¤§æ‰¹å¤„ç†: `rec_batch_num=12`
3. é™ä½æŠ½å¸§é¢‘ç‡: `fps=0.5`ï¼ˆMakefileï¼‰
4. ä½¿ç”¨ GPUï¼ˆå¦‚æœæœ‰ï¼‰

### Q5: ç«–æ’æ–‡å­—è¯†åˆ«ä¸å…¨

**è§£å†³æ–¹æ¡ˆ**:
```python
# å¯ç”¨æ–¹å‘åˆ†ç±»å™¨
use_angle_cls=True  # å·²é»˜è®¤å¯ç”¨
```

---

## è°ƒè¯•å·¥å…·

### å·¥å…· 1: å¿«é€ŸéªŒè¯è„šæœ¬
```bash
# æ£€æŸ¥ OCR æ˜¯å¦æ­£å¸¸å·¥ä½œ
python test_ocr_debug.py --check-api

# æµ‹è¯•å•å¼ å›¾ç‰‡
python test_ocr_debug.py --image path/to/image.png

# å¯¹æ¯”ä¸åŒé˜ˆå€¼
python test_ocr_debug.py --compare-thresholds

# æµ‹è¯•æ•´ä¸ªæ–‡ä»¶å¤¹
python test_ocr_debug.py --folder output/test_xxx/frames

# è¯¦ç»†è°ƒè¯•ä¿¡æ¯
python test_ocr_debug.py --image xxx.png --debug --visualize
```

### å·¥å…· 2: å‚æ•°æµ‹è¯•çŸ©é˜µ
```bash
# ç”Ÿæˆå‚æ•°ç»„åˆæµ‹è¯•æŠ¥å‘Š
python test_ocr_debug.py --param-matrix

# è¾“å‡º: æœ€ä½³å‚æ•°ç»„åˆå»ºè®®
```

### å·¥å…· 3: å¯è§†åŒ–æ£€æµ‹æ¡†
```bash
# ä¿å­˜å¸¦æ£€æµ‹æ¡†çš„å›¾ç‰‡
python test_ocr_debug.py --image xxx.png --visualize --output debug_output/
```

---

## æ€§èƒ½ä¼˜åŒ–

### é€Ÿåº¦ä¼˜åŒ–ç­–ç•¥

| ç­–ç•¥ | æ•ˆæœ | å‰¯ä½œç”¨ |
|------|------|--------|
| ä½¿ç”¨ mobile æ¨¡å‹ | å¿« 2-3x | å‡†ç¡®åº¦ç•¥é™ |
| é™ä½æŠ½å¸§é¢‘ç‡ (fps=0.5) | å¿« 2x | å¯èƒ½é—æ¼å†…å®¹ |
| å¢å¤§æ‰¹å¤„ç† (rec_batch_num=12) | å¿« 20% | å ç”¨æ›´å¤šå†…å­˜ |
| å…³é—­æ–¹å‘åˆ†ç±» | å¿« 10% | ç«–æ’æ–‡å­—è¯†åˆ«å·® |

### å‡†ç¡®åº¦ä¼˜åŒ–ç­–ç•¥

| ç­–ç•¥ | æ•ˆæœ | å‰¯ä½œç”¨ |
|------|------|--------|
| ä½¿ç”¨ server æ¨¡å‹ | å‡†ç¡®åº¦æå‡ 5-10% | é€Ÿåº¦æ…¢ 2-3x |
| é™ä½ det_db_thresh åˆ° 0.15 | æ£€æµ‹æ›´å¤šæ–‡æœ¬ | å¯èƒ½è¯¯æ£€ |
| é™ä½ min_score åˆ° 0.2 | ä¿ç•™æ›´å¤šç»“æœ | å¯èƒ½æœ‰è¯¯è¯†åˆ« |
| å¢å¤§ det_db_unclip_ratio | æ•è·è¾¹ç¼˜æ–‡æœ¬ | å¯èƒ½åŒ…å«å™ªç‚¹ |

### æ¨èé…ç½®æ–¹æ¡ˆ

#### æ–¹æ¡ˆ 1: å¿«é€Ÿæ¨¡å¼ï¼ˆæ—¥å¸¸ä½¿ç”¨ï¼‰
```python
# ocr_utils.py
det_db_thresh=0.25,
det_db_box_thresh=0.55,
det_db_unclip_ratio=1.6,
rec_batch_num=12,

# process_video.py
min_score=0.3
```

#### æ–¹æ¡ˆ 2: å¹³è¡¡æ¨¡å¼ï¼ˆæ¨èï¼‰âœ…
```python
# ocr_utils.py - å½“å‰é…ç½®
det_db_thresh=0.2,
det_db_box_thresh=0.5,
det_db_unclip_ratio=1.8,
rec_batch_num=6,

# process_video.py
min_score=0.25
```

#### æ–¹æ¡ˆ 3: ç²¾ç¡®æ¨¡å¼ï¼ˆé‡è¦å†…å®¹ï¼‰
```python
# ocr_utils.py
det_db_thresh=0.15,
det_db_box_thresh=0.45,
det_db_unclip_ratio=2.0,
rec_batch_num=6,

# process_video.py
min_score=0.2

# Makefile
make ocr VIDEO=xxx DET_MODEL=server REC_MODEL=server
```

---

## å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: æ•™å­¦è§†é¢‘ï¼ˆPPTæˆªå›¾ï¼‰
**ç‰¹ç‚¹**: é»‘æ¿/ç™½æ¿ï¼Œæ–‡å­—æ¸…æ™°ï¼Œå¯¹æ¯”åº¦é«˜

**æ¨èé…ç½®**:
```python
det_db_thresh=0.25
det_db_box_thresh=0.6
min_score=0.35
æ¨¡å‹: mobile
```

### æ¡ˆä¾‹ 2: è¡—æ™¯è§†é¢‘ï¼ˆæ ‡è¯†ç‰Œï¼‰
**ç‰¹ç‚¹**: å¤æ‚èƒŒæ™¯ï¼Œå…‰ç…§å˜åŒ–ï¼Œè‹±æ–‡æ•°å­—å¤š

**æ¨èé…ç½®**:
```python
det_db_thresh=0.15
det_db_box_thresh=0.45
det_db_unclip_ratio=2.0
min_score=0.2
æ¨¡å‹: serverï¼ˆå¦‚æœ‰æ¡ä»¶ï¼‰
```

### æ¡ˆä¾‹ 3: ç”µå½±å­—å¹•
**ç‰¹ç‚¹**: åº•éƒ¨å­—å¹•ï¼Œçº¯æ–‡æœ¬ï¼Œè§„æ•´

**æ¨èé…ç½®**:
```python
det_db_thresh=0.3
det_db_box_thresh=0.6
min_score=0.35
æ¨¡å‹: mobile
fps=1ï¼ˆå­—å¹•å˜åŒ–é¢‘ç‡ï¼‰
```

### æ¡ˆä¾‹ 4: ä»£ç æ¼”ç¤º
**ç‰¹ç‚¹**: å°å­—ä½“ï¼Œç­‰å®½å­—ä½“ï¼Œå¯†é›†æ–‡æœ¬

**æ¨èé…ç½®**:
```python
det_db_thresh=0.18
det_db_box_thresh=0.5
det_db_unclip_ratio=2.2
min_score=0.25
æ¨¡å‹: server
```

---

## å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# åŸºç¡€æµ‹è¯•
python test_ocr_debug.py --check-api

# å•å›¾è¯¦ç»†æµ‹è¯•
python test_ocr_debug.py --image xxx.png --debug --visualize

# æ–‡ä»¶å¤¹æ‰¹é‡æµ‹è¯•
python test_ocr_debug.py --folder output/test_xxx/frames --samples 10

# å‚æ•°å¯¹æ¯”
python test_ocr_debug.py --compare-thresholds

# å®Œæ•´è¿è¡Œï¼ˆä¼˜åŒ–å‚æ•°ï¼‰
make ocr VIDEO=test/test.mp4

# ä½¿ç”¨é«˜ç²¾åº¦æ¨¡å‹
make ocr VIDEO=xxx.mp4 DET_MODEL=server REC_MODEL=server
```

---

## æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡ä»¶
- `ocr_utils.py` - OCR æ ¸å¿ƒå®ç°
- `process_video.py` - ä¸»æµç¨‹
- `test_ocr_debug.py` - è°ƒè¯•å·¥å…·
- `docs/OCR_OPTIMIZATION.md` - ä¼˜åŒ–è¯´æ˜

### æ—¥å¿—åˆ†æ
æŸ¥çœ‹ OCR å¤„ç†æ—¥å¿—:
```bash
# è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºï¼š
ğŸ“Š æ‰¾åˆ° 52 ä¸ªå¸§å›¾ç‰‡ï¼Œå¼€å§‹OCRè¯†åˆ«...
ğŸ¯ ç½®ä¿¡åº¦é˜ˆå€¼: 0.25 (é™ä½é˜ˆå€¼å¯è¯†åˆ«æ›´å¤šæ–‡æœ¬)
ğŸ” OCRè¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 52/52 [02:15<00:00, 2.61s/å¸§]
âœ… OCR å®Œæˆï¼è¯†åˆ«åˆ° 1234 ä¸ªå­—ç¬¦ï¼Œ156 è¡Œæ–‡æœ¬
```

### é—®é¢˜æŠ¥å‘Š
å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æµ‹è¯•è§†é¢‘/å›¾ç‰‡
2. å½“å‰å‚æ•°é…ç½®
3. å®Œæ•´é”™è¯¯æ—¥å¿—
4. è¿è¡Œ `python test_ocr_debug.py --check-api` çš„è¾“å‡º

---

**æ›´æ–°æ—¶é—´**: 2025-12-11  
**ç‰ˆæœ¬**: v1.0
